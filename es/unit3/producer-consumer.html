<!DOCTYPE html>
<html lang="es-ES">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.24">
    <meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/psp_pages/psp_favicon.png"><title>3.3 Modelo productor-consumidor | Programación de Servicios y Procesos</title><meta name="description" content="Módulo PSP de 2º DAM">
    <link rel="preload" href="/psp_pages/assets/js/runtime~app.ac018b5f.js" as="script"><link rel="preload" href="/psp_pages/assets/css/styles.85ea3f07.css" as="style"><link rel="preload" href="/psp_pages/assets/js/812.63785eb3.js" as="script"><link rel="preload" href="/psp_pages/assets/js/app.07ba1842.js" as="script">
    <link rel="stylesheet" href="/psp_pages/assets/css/styles.85ea3f07.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/psp_pages/es/" class=""><img class="logo" src="/psp_pages/LogoIES.png" alt="Programación de Servicios y Procesos"><span class="site-name can-hide">Programación de Servicios y Procesos</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a class="nav-link external" href="https://aules.edu.gva.es/semipresencial/" rel="noopener noreferrer" target="_blank" aria-label="Aules FP Semi"><!--[--><!--]--> Aules FP Semi <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">Abrir en una ventana nueva</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Contenido del curso"><span class="title">Contenido del curso</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Contenido del curso"><span class="title">Contenido del curso</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/psp_pages/es/unit1/" class="nav-link" aria-label="Tema 1 - Introducción a la programación concurrente"><!--[--><!--]--> Tema 1 - Introducción a la programación concurrente <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/psp_pages/es/unit2/" class="nav-link" aria-label="Tema 2 - Programación de procesos en Java"><!--[--><!--]--> Tema 2 - Programación de procesos en Java <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/psp_pages/es/unit3/" class="nav-link router-link-active" aria-label="Tema 3 - Programación multihilo en Java"><!--[--><!--]--> Tema 3 - Programación multihilo en Java <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Idioma"><span class="title">Idioma</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Idioma"><span class="title">Idioma</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/psp_pages/en/unit3/producer-consumer.html" class="nav-link" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="dropdown-item"><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="Castellano"><!--[--><!--]--> Castellano <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/psp2dam/apuntes_psp" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">Abrir en una ventana nueva</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a class="nav-link external" href="https://aules.edu.gva.es/semipresencial/" rel="noopener noreferrer" target="_blank" aria-label="Aules FP Semi"><!--[--><!--]--> Aules FP Semi <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">Abrir en una ventana nueva</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Contenido del curso"><span class="title">Contenido del curso</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Contenido del curso"><span class="title">Contenido del curso</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/psp_pages/es/unit1/" class="nav-link" aria-label="Tema 1 - Introducción a la programación concurrente"><!--[--><!--]--> Tema 1 - Introducción a la programación concurrente <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/psp_pages/es/unit2/" class="nav-link" aria-label="Tema 2 - Programación de procesos en Java"><!--[--><!--]--> Tema 2 - Programación de procesos en Java <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/psp_pages/es/unit3/" class="nav-link router-link-active" aria-label="Tema 3 - Programación multihilo en Java"><!--[--><!--]--> Tema 3 - Programación multihilo en Java <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Idioma"><span class="title">Idioma</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Idioma"><span class="title">Idioma</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/psp_pages/en/unit3/producer-consumer.html" class="nav-link" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="dropdown-item"><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="Castellano"><!--[--><!--]--> Castellano <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/psp2dam/apuntes_psp" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">Abrir en una ventana nueva</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">Tema 3 - Programación multihilo en Java</p><ul class=""><li><!--[--><a href="/psp_pages/es/unit3/" class="nav-link router-link-active sidebar-item" aria-label="3 Introducción"><!--[--><!--]--> 3 Introducción <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/psp_pages/es/unit3/runnable.html" class="nav-link sidebar-item" aria-label="3.1. Clases Java para la gestión de hilos"><!--[--><!--]--> 3.1. Clases Java para la gestión de hilos <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/psp_pages/es/unit3/synchronization.html" class="nav-link sidebar-item" aria-label="3.2 Sincronización y comunicación de hilos"><!--[--><!--]--> 3.2 Sincronización y comunicación de hilos <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="3.3 Modelo productor-consumidor"><!--[--><!--]--> 3.3 Modelo productor-consumidor <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html#_3-3-1-esquema-de-sincronizacion-y-comunicacion-de-hilos" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="3.3.1. Esquema de sincronización y comunicación de hilos"><!--[--><!--]--> 3.3.1. Esquema de sincronización y comunicación de hilos <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html#_3-3-2-clase-principal" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="3.3.2 Clase Principal"><!--[--><!--]--> 3.3.2 Clase Principal <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html#_3-3-3-clase-productor-y-consumidor" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="3.3.3 Clase Productor y Consumidor"><!--[--><!--]--> 3.3.3 Clase Productor y Consumidor <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html#_3-3-4-clase-compartida-sincronizacion-de-hilos" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="3.3.4 Clase Compartida. Sincronización de hilos"><!--[--><!--]--> 3.3.4 Clase Compartida. Sincronización de hilos <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/psp_pages/es/unit3/alternatives.html" class="nav-link sidebar-item" aria-label="3.4 Mecanismos alternativos de sincronización"><!--[--><!--]--> 3.4 Mecanismos alternativos de sincronización <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/psp_pages/es/unit3/debugger_annex.html" class="nav-link sidebar-item" aria-label="3.5 Anexo I - Debugging aplicaciones multihilo en Netbeans"><!--[--><!--]--> 3.5 Anexo I - Debugging aplicaciones multihilo en Netbeans <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><div true class="downloadLink" align="right"><a href="/psp_pages/pdf/3.3 Modelo productor-consumidor.pdf" download><img src="/psp_pages/images/download-pdf.png" title="descarga como PDF" alt="descarga PDF" height="50"></a><a href="/psp_pages/pdf/3.3 Modelo productor-consumidor.pdf" target="_blank"><img src="/psp_pages/images/open-pdf.png" title="abre como PDF" alt="abre PDF" height="50"></a></div><div true class="documentcover" align="center"><img src="/psp_pages/images/LogoPSP_mini_es.png" alt="PSP Logo"><h1>3.3 Modelo productor-consumidor</h1><h2></h2><img src="/psp_pages/LogoIES.png" alt="Logo IES Doctor Balmis" style="padding:2cm;"><div true class="cclicense" align="center"><p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="https://psp2dam.github.io/psp_sources/es/">Apuntes de PSP</a> creados por <span property="cc:attributionName">Vicente Martínez</span> bajo licencia <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.es" target="_blank" rel="license noopener noreferrer" style="display:inline-block;"> CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></p></div><div class="pagebreak"></div></div><h1 id="_3-3-modelo-productor-consumidor" tabindex="-1">3.3 Modelo productor-consumidor</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html#_3-3-1-esquema-de-sincronizacion-y-comunicacion-de-hilos" class="router-link-active router-link-exact-active">3.3.1. Esquema de sincronización y comunicación de hilos</a></li><li><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html#_3-3-2-clase-principal" class="router-link-active router-link-exact-active">3.3.2 Clase Principal</a></li><li><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html#_3-3-3-clase-productor-y-consumidor" class="router-link-active router-link-exact-active">3.3.3 Clase Productor y Consumidor</a></li><li><a aria-current="page" href="/psp_pages/es/unit3/producer-consumer.html#_3-3-4-clase-compartida-sincronizacion-de-hilos" class="router-link-active router-link-exact-active">3.3.4 Clase Compartida. Sincronización de hilos</a></li></ul></nav><h2 id="_3-3-1-esquema-de-sincronizacion-y-comunicacion-de-hilos" tabindex="-1">3.3.1. Esquema de sincronización y comunicación de hilos</h2><p>La sincronización de threads implica disponer de mecanismos que permitan asegurar que no se producen situaciones de <code>inanición o starvation</code> (bloqueo de hilos como consecuencia del acceso a recursos compartidos limitados), <code>interbloqueos</code> (espera por parte de los hilos cuando una condición no puede ser satisfecha) y que, por lo tanto, se opera de forma correcta con los recursos compartidos por hilos concurrentes.</p><p>En esta sección vamos a ejemplificar la compartición de recursos a través de un objeto contenedor (objeto compartido) mediante el famoso algoritmo del Productor-Consumidor que podemos ver resumido en <a href="https://es.wikipedia.org/wiki/Problema_productor-consumidor" target="_blank" rel="noopener noreferrer">Wikipedia<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">Abrir en una ventana nueva</span><!--]--></span></a>.</p><p>Si no se implementasen medidas de control, ya hemos visto que podrían darse situacion anómalas como:</p><ul><li>El consumidor puede obtener los elementos producidos más de una vez, excediendo la producción del mismo (poder dejar la cuenta en números rojos en el ejemplo del banco, o que un lector pueda leer un libro antes de estar terminado).</li><li>El productor sea más rápido que el Consumidor y genere más información de la que el sistema pueda almacenar, o bien parte de la información que genere se pierda sin que un Consumidor la haya recuperado.</li><li>El Consumidor es más rápidos que el Productor y puede terminar consumiendo dos o más veces el mismo valor, generando información inconsistente en el sistema.</li></ul><p>Todas estas circunstancias son las que conocemos como condiciones de carrera o <code>race conditions</code>.</p><p>El esquema de clases representado por este modelo se repite fielmente entre los diferentes ejercicios que vamos a realizar, es lo que denominamos el modelo Productor-Consumidor.</p><p><img src="/psp_pages/assets/img/ProducerConsumer.d96a041f.png" alt="Producer-Consumer"></p><p>Este modelo se basa en tres clases, aunque dependiendo del problema, podemos encontrarnos que no tenemos <strong>productor</strong> o <strong>consumidor</strong>.</p><div class="custom-container info"><p class="custom-container-title">Modelo como patrón de diseño</p><p>Es importante que nos ajustemos al esquema presentado en el modelo.</p><p>Como ya se ha dicho, a veces no habrá productor, otras no estará el consumidor, en otras el código de bloqueo estará sólo en una de las clases, pero no debemos inventar ni añadir nada al esquema, debemos encajar el problema a solucionar dentro del código proporcionado.</p></div><h2 id="_3-3-2-clase-principal" tabindex="-1">3.3.2 Clase Principal</h2><blockquote><p>La clase principal siempre va a tener la misma estructura. El siguiente código se puede usar como plantilla</p></blockquote><p>En esta clase se declara el objeto o propiedad que van a compartir el productor y el consumidor. Este objeto es a través del que se realiza la comunicación, sincronización e intercambio de información entre los hilos.</p><p>Aquí se representa como un objeto, aunque puede ser una Colección o cualquier estructura de datos que puedan compartir los hilos.</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#FAFAFA;"><code><span class="line"><span style="color:#9C3EDA;">public</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">class</span><span style="color:#90A4AE;"> </span><span style="color:#E2931D;">ClasePrincipal</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span><span style="color:#90A4AE;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#9C3EDA;">public</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">static</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">void</span><span style="color:#90A4AE;"> </span><span style="color:#6182B8;">main</span><span style="color:#39ADB5;">(</span><span style="color:#9C3EDA;">String</span><span style="color:#39ADB5;">[]</span><span style="color:#90A4AE;"> args</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span><span style="color:#90A4AE;">    </span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#9C3EDA;">ClaseCompartida</span><span style="color:#90A4AE;"> objetoCompartido </span><span style="color:#39ADB5;">=</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;font-style:italic;">new</span><span style="color:#90A4AE;"> </span><span style="color:#6182B8;">ObjetoCompartido</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#9C3EDA;">Productor</span><span style="color:#90A4AE;"> p  </span><span style="color:#39ADB5;">=</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;font-style:italic;">new</span><span style="color:#90A4AE;"> </span><span style="color:#6182B8;">Productor</span><span style="color:#39ADB5;">(</span><span style="color:#90A4AE;">objetoCompartido</span><span style="color:#39ADB5;">);</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#9C3EDA;">Consumidor</span><span style="color:#90A4AE;"> c  </span><span style="color:#39ADB5;">=</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;font-style:italic;">new</span><span style="color:#90A4AE;"> </span><span style="color:#6182B8;">Consumidor</span><span style="color:#39ADB5;">(</span><span style="color:#90A4AE;">objetoCompartido</span><span style="color:#39ADB5;">);</span></span>
<span class="line"><span style="color:#90A4AE;">        productor</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">start</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#90A4AE;">        consumidor</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">start</span><span style="color:#39ADB5;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// No es obligatorio, pero en ocasiones puede interesar que la ClasePrincipal</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// espere a que acaben los hilos</span></span>
<span class="line"><span style="color:#90A4AE;">        productor</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">join</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#90A4AE;">        consumidor</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">join</span><span style="color:#39ADB5;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// Acciones a realizar una vez hayan acabado el productor y el consumidor</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#90A4AE;">    </span></span>
<span class="line"><span style="color:#39ADB5;">}</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="custom-container warning"><p class="custom-container-title">Número de hilos por tipo</p><p>En el ejemplo se crea un hilo de cada tipo. Esto no tiene porqué ser así.</p><p>Cada problema determinará el número de hilos <em>Productores</em> y <em>Consumidores</em> necesarios, por lo que será en este método main, o en algún otro método de la <em>ClasePrincipal</em> donde se realice la gestión de los hilos.</p><p>De igual forma, dependerá de cada problema si el hilo principal debe esperar a que el resto finalice o no.</p></div><div class="pagebreak"></div><h2 id="_3-3-3-clase-productor-y-consumidor" tabindex="-1">3.3.3 Clase Productor y Consumidor</h2><blockquote><p>Por otro lado vamos a tener la clase del <strong>productor</strong> y del <strong>consumidor</strong> que se encargan de realizar las llamadas necesarias a los métodos del objeto compartido que reciben como parámetro.</p></blockquote><p>Estas dos clases son las que van a tener, dentro del método <strong>run</strong>, la lógica de la aplicación, accediendo al objeto compartido, modificando las propiedades compartidas entre los diferentes hilos (productores y/o consumidores) y actualizando el estado del objeto compartido para que module su funcionalidad.</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#FAFAFA;"><code><span class="line"><span style="color:#9C3EDA;">public</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">class</span><span style="color:#90A4AE;"> </span><span style="color:#E2931D;">Consumidor</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">extends</span><span style="color:#90A4AE;"> </span><span style="color:#E2931D;">Thread</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#9C3EDA;">private</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">ClaseCompartida</span><span style="color:#90A4AE;"> objetoCompartido</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    </span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#6182B8;">Consumidor</span><span style="color:#39ADB5;">(</span><span style="color:#9C3EDA;">ClaseCompartida</span><span style="color:#90A4AE;"> objetoCompartido</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">this.</span><span style="color:#90A4AE;">objetoCompartido </span><span style="color:#39ADB5;">=</span><span style="color:#90A4AE;"> objetoCompartido</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#90A4AE;">    </span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">@</span><span style="color:#9C3EDA;">Override</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#9C3EDA;">public</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">void</span><span style="color:#90A4AE;"> </span><span style="color:#6182B8;">run</span><span style="color:#39ADB5;">()</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// La ejecución del método run estará normalmente gestionada por un bucle</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// que controlará el ciclo de vida del hilo y se adaptará al problema.</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// En el caso de simulaciones se harán esperas proporcionales.</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;font-style:italic;">try</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">            </span><span style="color:#90A4AE;font-style:italic;">// Código que hace el hilo consumidor</span></span>
<span class="line"><span style="color:#90A4AE;">            objetoCompartido</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">accionDeConsumir</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#39ADB5;">            </span><span style="color:#90A4AE;font-style:italic;">// La espera es opcional</span></span>
<span class="line"><span style="color:#90A4AE;">            Thread</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">sleep</span><span style="color:#39ADB5;">((</span><span style="color:#9C3EDA;">long</span><span style="color:#39ADB5;">)(</span><span style="color:#90A4AE;">Math</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">random</span><span style="color:#39ADB5;">()*</span><span style="color:#F76D47;">1000</span><span style="color:#39ADB5;">+</span><span style="color:#F76D47;">1000</span><span style="color:#39ADB5;">));</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">}</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;font-style:italic;">catch</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">(</span><span style="color:#9C3EDA;">InterruptedException</span><span style="color:#90A4AE;"> ex</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">}</span><span style="color:#90A4AE;">         </span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#39ADB5;">}</span><span style="color:#90A4AE;">    </span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#FAFAFA;"><code><span class="line"><span style="color:#9C3EDA;">public</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">class</span><span style="color:#90A4AE;"> </span><span style="color:#E2931D;">Productor</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">extends</span><span style="color:#90A4AE;"> </span><span style="color:#E2931D;">Thread</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#9C3EDA;">private</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">ClaseCompartida</span><span style="color:#90A4AE;"> objetoCompartido</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    </span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#6182B8;">Productor</span><span style="color:#39ADB5;">(</span><span style="color:#9C3EDA;">ClaseCompartida</span><span style="color:#90A4AE;"> objetoCompartido</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">this.</span><span style="color:#90A4AE;">objetoCompartido </span><span style="color:#39ADB5;">=</span><span style="color:#90A4AE;"> objetoCompartido</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#90A4AE;">    </span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">@</span><span style="color:#9C3EDA;">Override</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#9C3EDA;">public</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">void</span><span style="color:#90A4AE;"> </span><span style="color:#6182B8;">run</span><span style="color:#39ADB5;">()</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// La ejecución del método run estará normalmente gestionada por un bucle</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// que controlará el ciclo de vida del hilo y se adaptará al problema.</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// En el caso de simulaciones se harán esperas proporcionales.</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;font-style:italic;">try</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">            </span><span style="color:#90A4AE;font-style:italic;">// Código que hace el hilo productor</span></span>
<span class="line"><span style="color:#90A4AE;">            objetoCompartido</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">accionDeProducir</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#39ADB5;">            </span><span style="color:#90A4AE;font-style:italic;">// La espera es opcional</span></span>
<span class="line"><span style="color:#90A4AE;">            Thread</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">sleep</span><span style="color:#39ADB5;">((</span><span style="color:#9C3EDA;">long</span><span style="color:#39ADB5;">)(</span><span style="color:#90A4AE;">Math</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">random</span><span style="color:#39ADB5;">()*</span><span style="color:#F76D47;">1000</span><span style="color:#39ADB5;">+</span><span style="color:#F76D47;">1000</span><span style="color:#39ADB5;">));</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">}</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;font-style:italic;">catch</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">(</span><span style="color:#9C3EDA;">InterruptedException</span><span style="color:#90A4AE;"> ex</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">}</span><span style="color:#90A4AE;">         </span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#39ADB5;">}</span><span style="color:#90A4AE;"> </span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="pagebreak"></div><h2 id="_3-3-4-clase-compartida-sincronizacion-de-hilos" tabindex="-1">3.3.4 Clase Compartida. Sincronización de hilos</h2><p>El modelo se completa con la clase compartida. Aquí vamos a crear los métodos a los que acceden productores y consumidores y, además, vamos a realizar la sincronización entre hilos para que no se produzcan <code>condiciones de carrera</code>.</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#FAFAFA;"><code><span class="line"><span style="color:#9C3EDA;">class</span><span style="color:#90A4AE;"> </span><span style="color:#E2931D;">ClaseCompartida</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#9C3EDA;">int</span><span style="color:#90A4AE;"> valorAccedidoSimultaneamente</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    </span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#6182B8;">ClaseCompartida</span><span style="color:#39ADB5;">()</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// Se inicializa el valor</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">this.</span><span style="color:#90A4AE;">valorAccedidoSimultaneamente </span><span style="color:#39ADB5;">=</span><span style="color:#90A4AE;"> </span><span style="color:#F76D47;">0</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#9C3EDA;">public</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">synchronized</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">void</span><span style="color:#90A4AE;"> </span><span style="color:#6182B8;">accionDeConsumir</span><span style="color:#39ADB5;">()</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// Si no se cumple la condición para poder consumir, el consumidor debe esperar</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;font-style:italic;">while</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">(</span><span style="color:#6182B8;">valorAccedidoSimultaneamente</span><span style="color:#39ADB5;">()</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">==</span><span style="color:#90A4AE;"> </span><span style="color:#F76D47;">0</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">            </span><span style="color:#39ADB5;font-style:italic;">try</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">                System</span><span style="color:#39ADB5;">.</span><span style="color:#90A4AE;">out</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">println</span><span style="color:#39ADB5;">(</span><span style="color:#39ADB5;">&quot;</span><span style="color:#91B859;">Consumidor espera...</span><span style="color:#39ADB5;">&quot;</span><span style="color:#39ADB5;">);</span></span>
<span class="line"><span style="color:#90A4AE;">                </span><span style="color:#6182B8;">wait</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#90A4AE;">            </span><span style="color:#39ADB5;">}</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;font-style:italic;">catch</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">(</span><span style="color:#9C3EDA;">InterruptedException</span><span style="color:#90A4AE;"> ex</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">                </span><span style="color:#90A4AE;font-style:italic;">// Si es necesario se realizará la gestión de la Interrupción</span></span>
<span class="line"><span style="color:#90A4AE;">            </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#90A4AE;">                </span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// Cuando se ha cumplido la condición para consumir, el consumidor consume</span></span>
<span class="line"><span style="color:#90A4AE;">        valorAccedidoSimultaneamente</span><span style="color:#39ADB5;">--;</span></span>
<span class="line"><span style="color:#90A4AE;">        System</span><span style="color:#39ADB5;">.</span><span style="color:#90A4AE;">out</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">printf</span><span style="color:#39ADB5;">(</span><span style="color:#39ADB5;">&quot;</span><span style="color:#91B859;">Se ha consumido: %d.</span><span style="color:#90A4AE;">\n</span><span style="color:#39ADB5;">&quot;</span><span style="color:#39ADB5;">,</span><span style="color:#90A4AE;"> valorAccedidoSimultaneamente</span><span style="color:#39ADB5;">);</span><span style="color:#90A4AE;">        </span></span>
<span class="line"></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// Se activa a otros hilos que puedan estar en espera</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#6182B8;">notifyAll</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#90A4AE;">    </span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#9C3EDA;">public</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">synchronized</span><span style="color:#90A4AE;"> </span><span style="color:#9C3EDA;">void</span><span style="color:#90A4AE;"> </span><span style="color:#6182B8;">accionDeProducir</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">()</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// Si no se cumple la condición para poder producir, el productor debe esperar</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;font-style:italic;">while</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">(</span><span style="color:#6182B8;">valorAccedidoSimultaneamente</span><span style="color:#39ADB5;">()</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">&gt;</span><span style="color:#90A4AE;"> </span><span style="color:#F76D47;">10</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">            </span><span style="color:#39ADB5;font-style:italic;">try</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#90A4AE;">                System</span><span style="color:#39ADB5;">.</span><span style="color:#90A4AE;">out</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">println</span><span style="color:#39ADB5;">(</span><span style="color:#39ADB5;">&quot;</span><span style="color:#91B859;">Productor espera...</span><span style="color:#39ADB5;">&quot;</span><span style="color:#39ADB5;">);</span></span>
<span class="line"><span style="color:#90A4AE;">                </span><span style="color:#6182B8;">wait</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#90A4AE;">            </span><span style="color:#39ADB5;">}</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;font-style:italic;">catch</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">(</span><span style="color:#9C3EDA;">InterruptedException</span><span style="color:#90A4AE;"> ex</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;"> </span><span style="color:#39ADB5;">{</span></span>
<span class="line"><span style="color:#39ADB5;">                </span><span style="color:#90A4AE;font-style:italic;">// Si es necesario se realizará la gestión de la Interrupción                </span></span>
<span class="line"><span style="color:#90A4AE;">            </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#39ADB5;">}</span></span>
<span class="line"><span style="color:#90A4AE;">        </span></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// Cuando se ha cumplido la condición para producir, el productor produce</span></span>
<span class="line"><span style="color:#90A4AE;">        valorAccedidoSimultaneamente</span><span style="color:#39ADB5;">++;</span></span>
<span class="line"><span style="color:#90A4AE;">        System</span><span style="color:#39ADB5;">.</span><span style="color:#90A4AE;">out</span><span style="color:#39ADB5;">.</span><span style="color:#6182B8;">printf</span><span style="color:#39ADB5;">(</span><span style="color:#39ADB5;">&quot;</span><span style="color:#91B859;">Se ha producido: %d.</span><span style="color:#90A4AE;">\n</span><span style="color:#39ADB5;">&quot;</span><span style="color:#39ADB5;">,</span><span style="color:#90A4AE;"> valorAccedidoSimultaneamente</span><span style="color:#39ADB5;">);</span><span style="color:#90A4AE;">        </span></span>
<span class="line"></span>
<span class="line"><span style="color:#39ADB5;">        </span><span style="color:#90A4AE;font-style:italic;">// Se activa a otros hilos que puedan estar en espera</span></span>
<span class="line"><span style="color:#90A4AE;">        </span><span style="color:#6182B8;">notifyAll</span><span style="color:#39ADB5;">();</span></span>
<span class="line"><span style="color:#90A4AE;">    </span><span style="color:#39ADB5;">}</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br><br><br><br><br><br><div class="highlight-line"> </div><br><div class="highlight-line"> </div><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><div class="highlight-line"> </div><br><br><div class="highlight-line"> </div><br><div class="highlight-line"> </div><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><div class="highlight-line"> </div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>Lo interesante del código anterior, como ya hemos visto con anterioridad, es la pareja de métodos <code>wait / notifyAll</code>, junto con el modificador <code>synchronized</code>.</p><ul><li>Cuando se llama a un método <strong>synchronized</strong> este método se ejecuta sí y solo sí no hay otro hilo ejecutando otro método <strong>synchronized</strong> <code>del mismo objeto</code>. Si se diese ese caso, el hilo se quedará en espera hasta que otro hilo ejecute una llamada <strong>notifyAll</strong>. En ese momento todos los hilos que estén esperando se despiertan y sólo uno de ellos vuelve a ejecutarse.</li><li>Cuando se hace una llamada al método <strong>wait</strong>, un hilo se queda en espera y, además, libera el bloqueo de uso del método <strong>synchronized</strong>. El hilo se quedará en espera hasta que otro hilo ejecute una llamada <strong>notifyAll</strong>.</li><li>Cuando se hace una llamada al método <strong>notifyAll</strong>, todos los hilos que están en espera por haber hecho <strong>wait</strong> se despiertan y pasan a esperar poder tomar el control del bloqueo del <strong>synchronized</strong>. A partir de ese momento, de forma aleatoria, uno de ellos o de lo que ya estaban en la cola del bloqueo <strong>synchronized</strong> toma el control y empieza/sigue ejecutándose.</li></ul><blockquote><p>Con los métodos <strong>wait</strong>, <strong>notifyAll</strong> y los bloques de código <strong>synchronized</strong> se consigue evitar que varios hilos puedan modificar a la vez una variable <em>(Ver líneas 21 y 40 del ejemplo anterior)</em>.</p></blockquote><div class="custom-container info"><p class="custom-container-title">Resumen del modelo Productor-Consumidor</p><p>El modelo Productor-Consumidor original trabaja con un buffer en el que el Productor va depositando información y el Consumidor la va sacando, de forma que el buffer nunca se llene ni se pueda leer si está vacío.</p><p>En nuestro ejemplo, lo hemos simplificado al uso de una variable que nunca puede exceder el valor de 10 ni ser inferior a 0.</p><p>Como ya hemos dicho, esa variable puede ser cualquier tipo de dato, y el código de las clases variará en función de ello, para adaptarlo al problema y al control del tipo de dato utilizado.</p><p>Además, las condiciones o estados que se utilizan para las esperas y las actualizaciones será lo que nosotros, como programadores, tengamos que adaptar al modelo para hacerlo funcionar en situaciones diferentes.</p></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/psp2dam/apuntes_psp/edit/master/docs/es/unit3/producer-consumer.md" rel="noopener noreferrer" target="_blank" aria-label="Ayúdanos a mejorar esta página en GitHub!"><!--[--><!--]--> Ayúdanos a mejorar esta página en GitHub! <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">Abrir en una ventana nueva</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Última actualización: : </span><span class="meta-item-info">2/11/2021 16:42:22</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: vicente@iesdoctorbalmis.com">Vicente Martínez</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/psp_pages/es/unit3/synchronization.html" class="nav-link" aria-label="3.2 Sincronización y comunicación de hilos"><!--[--><!--]--> 3.2 Sincronización y comunicación de hilos <!--[--><!--]--></a></span><span class="next"><a href="/psp_pages/es/unit3/alternatives.html" class="nav-link" aria-label="3.4 Mecanismos alternativos de sincronización"><!--[--><!--]--> 3.4 Mecanismos alternativos de sincronización <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/psp_pages/assets/js/runtime~app.ac018b5f.js" defer></script><script src="/psp_pages/assets/js/812.63785eb3.js" defer></script><script src="/psp_pages/assets/js/app.07ba1842.js" defer></script>
  </body>
</html>
