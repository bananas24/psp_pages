import{_ as u,a as r}from"./comandotree.fa02cb62.js";import{_ as d,r as p,o as k,c as m,d as a,a as n,w as t,b as s,f as c}from"./app.108f91ed.js";const v={},b=n("h1",{id:"_2-2-gestion-de-procesos-en-java-processbuilder-y-process",tabindex:"-1"},"2.2 Gesti\xF3n de procesos en Java - ProcessBuilder y Process",-1),g={class:"table-of-contents"},f=s("2.2.1 Preparaci\xF3n y configuraci\xF3n de un proceso"),y=s("Modificar el comando en tiempo de ejecuci\xF3n"),h=s("Configuraciones adicionales de un proceso"),q=s("2.2.2 Acceso al proceso una vez en ejecuci\xF3n"),w=s("Lanzar una clase Java como proceso desde otra clase java en el mismo proyecto"),j=n("h2",{id:"_2-2-1-preparacion-y-configuracion-de-un-proceso",tabindex:"-1"},"2.2.1 Preparaci\xF3n y configuraci\xF3n de un proceso",-1),S=n("p",null,[s("En el paquete "),n("code",null,"java.lang"),s(" tenemos dos clases para la gesti\xF3n de procesos.")],-1),_=n("code",null,"java.lang.ProcessBuilder",-1),P=s(),x={href:"https://docs.oracle.com/javase/8/docs/api/java/lang/ProcessBuilder.html",target:"_blank",rel:"noopener noreferrer"},E=s("Referencia API Java"),A=n("code",null,"java.lang.Process",-1),B=s(),z={href:"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ProcessBuilder.html",target:"_blank",rel:"noopener noreferrer"},C=s("Referencia API Java"),L=c(`<p>Las instancias de <strong>ProcessBuilder</strong> gestionan los atributos de los procesos, mientras que las instancias de <strong>Process</strong> controlan la ejecuci\xF3n de esos mismos procesos cuando se ejecutan.</p><p>Antes de ejecutar un nuevo proceso, podemos configurar los par\xE1metros de ejecuci\xF3n del mismo usando la clase <code>ProcessBuilder</code>.</p><p>ProcessBuilder es una clase auxiliar de la clase Process, que veremos m\xE1s adelante, y se utiliza para controlar algunos par\xE1metros de ejecuci\xF3n que afectar\xE1n al proceso. A trav\xE9s de la llamada al m\xE9todo <code>start</code> se crea un nuevo proceso en el sistema con los atributos definidos en la instancia de ProcessBuilder.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/C&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DIR&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Process</span> p <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Si llamamos varias veces al m\xE9todo start, se crear\xE1n tantos nuevos procesos como llamadas hagamos, todos ellos con los mismos atributos.</p><p>La clase ProcessBuilder define un par de constructores:</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> command<span class="token punctuation">)</span>
<span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> command<span class="token punctuation">)</span>
</code></pre></div><p>El funcionamiento de ambos es el mismo. En el primer constructor el comando se pasa el comando a ejecutar y la lista de argumentos como una lista de cadenas. Por contra, en el segundo constructor, el comando y sus argumentos se pasan a trav\xE9s de un n\xFAmero variable de cadenas (String ... es lo que en Java se llama varargs). La versi\xF3n que utilicemos depende del formato en que tengamos los datos.</p><p>:: danger Argumentos y par\xE1metros Si queremos lanzar un programa con par\xE1metros (modificadores que hacen que cambie la forma de funcionar un programa como -h /s ...)el comando no puede ser pasado al constructor directamente como un \xFAnico string, debe ser preprocesado para convertirlo en una lista y que funcione.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Formas diferentes de pasar el comando a los constructores de ProcessBuilder</span>
<span class="token comment">// 1\xAA forma: usando una cadena. Falla con par\xE1metros</span>
<span class="token comment">// S\xF3lo funciona con programas que tengan argumentos</span>
<span class="token class-name">String</span> command1 <span class="token operator">=</span> <span class="token string">&quot;notepad.exe prueba1.txt&quot;</span>
<span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2\xAA forma: usando un array de cadenas. Funciona con par\xE1metros</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> command2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;cmd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dir&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/o&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3\xAA forma: usando una cadena y dividi\xE9ndola para convertirla en una lista</span>
<span class="token class-name">String</span> command3 <span class="token operator">=</span>  <span class="token string">&quot;c:/windows/system32/shutdown -s -t 0&quot;</span><span class="token punctuation">;</span>  
<span class="token comment">// La expresi\xF3n regular \\s significa partir por los espacios en blanco</span>
<span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command3<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10),U={class:"custom-container warning"},F=n("p",{class:"custom-container-title"},"OS shutdown",-1),D=n("p",null,"You can use shutdown -s command to shutdown system. For windows OS, you need to provide full path of shutdown command e.g. C:\\Windows\\System32\\shutdown.",-1),V=n("p",null,"Here you can use -s switch to shutdown system, -r switch to restart system, -h to put the system into hibernation, and -t switch to specify time delay.",-1),I={href:"https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/shutdown",target:"_blank",rel:"noopener noreferrer"},M=s("Windows shutdown reference"),O=c(`<p>::: question Activity psp.activities.U2A1_Shutdowner Create a new Java application project (package psp.activities &amp; main class U2A1_Shutdowner) Using the command line, ask the user for the action he wants to do with the computer (shutdown ,restart or suspend) and how much time he needs before shutting down the system.</p><p>Find information about the shutdown command in GNU/Linux and make your app work in both systems.</p><p>Your app has to prepare the right command for the answers the user has given and for the OS it is running on.</p><p>Get the ProcessBuilder.command() result and show it on the console in a readable format. :::</p><details class="custom-container details"><summary>Soluci\xF3n de U2A1_Shutdowner</summary><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">U2A1_Shutdowner</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// Ask for the required information to prepare the command</span>
        <span class="token class-name">Scanner</span> keyboard <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Select your option (s-shutdown / r-reboot / h-hibernate): &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> shutdownOption <span class="token operator">=</span> keyboard<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;How much seconds will the command wait to be run? (0 means immediately): &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> shutdownTime <span class="token operator">=</span> keyboard<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        
        <span class="token comment">// Prepare the command</span>
        <span class="token class-name">String</span> command<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;os.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;windows&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            command <span class="token operator">=</span> <span class="token string">&quot;C:/Windows/System32/shutdown -&quot;</span> <span class="token operator">+</span> shutdownOption <span class="token operator">+</span> <span class="token string">&quot; -t &quot;</span> <span class="token operator">+</span> shutdownTime<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            command <span class="token operator">=</span> <span class="token string">&quot;shutdown -&quot;</span> <span class="token operator">+</span> shutdownOption <span class="token operator">+</span> <span class="token string">&quot; -t &quot;</span> <span class="token operator">+</span> shutdownTime<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Prepare the process and launch it</span>
        <span class="token class-name">ProcessBuilder</span> shutdowner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//shutdowner.start();</span>
        
        <span class="token comment">// Show the command to be run</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;El comando a ejecutar es:  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> commandPart<span class="token operator">:</span> shutdowner<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>commandPart <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="modificar-el-comando-en-tiempo-de-ejecucion" tabindex="-1">Modificar el comando en tiempo de ejecuci\xF3n</h3><p>Puede ser que todo el comando, o parte del mismo, no lo tengamos en el momento de llamar a los constructores de ProcessBuilder. Se puede cambiar, modificar y consultar a posteriori con el m\xE9todo <code>command</code></p><p>Al igual que con los constructores, tenemos dos versiones del m\xE9todo command</p><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token function">command</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> command<span class="token punctuation">)</span>
    <span class="token function">command</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> command<span class="token punctuation">)</span>
</code></pre></div><p>y la tercera forma de este m\xE9todo (sin par\xE1metros) sirve para obtener una lista del comando pasado al constructor o puesto con alguna de las formas anterior del m\xE9todo command. Lo interesante es que una vez que tenemos la lista, podemos modificarla usando los m\xE9todos de la clase List.</p><p>En el siguiente ejemplo, en el momento de definir el comando, nos falta saber la \xFAltima parte, el directorio temporal. Adem\xE1s, si queremos hacer que la ejecuci\xF3n sea multiplataforma, el shell a ejecutar tampoco lo sabemos. Dependiendo del SO se a\xF1aden dos valores al principio y un valor al final, con el m\xE9todo add de la clase List.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Sets and modifies the command after ProcessBuilder object is created</span>
<span class="token class-name">String</span> command <span class="token operator">=</span> <span class="token string">&quot;java -jar install.jar -install&quot;</span><span class="token punctuation">;</span> <span class="token comment">// tmp dir is missing</span>
<span class="token class-name">ProcessBuilder</span> pbuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isWindows<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pbuilder<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;cmd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sets the 1st element</span>
    pbuilder<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;/c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sets the 2nd element</span>
    pbuilder<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;c:/temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sets the last element</span>
    <span class="token comment">// Command to run cmd /c java -jar install.jar -install c:/temp</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    pbuilder<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;sh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sets the 1st element</span>
    pbuilder<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sets the 2nd element</span>
    pbuilder<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;/tmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sets the last element</span>
    <span class="token comment">// Command to run: sh -c java -jar install.jar -install /tmp</span>
<span class="token punctuation">}</span>

<span class="token comment">// Starts the process</span>
pbuilder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="configuraciones-adicionales-de-un-proceso" tabindex="-1">Configuraciones adicionales de un proceso</h3><p>Algunos de los atributos que podemos configurar para un proceso son:</p><ul><li><p>Establecer el directorio de trabajo donde el proceso se ejecutar\xE1 Podemos cambiar el directorio de trabajo por defecto llamando al m\xE9todo <code>directory</code> y pas\xE1ndole un objeto de tipo File. <strong>Por defecto, el directorio de trabajo se establece al valor de la variable del sistema user.dir</strong>. Este directorio es el punto de partida para acceder a ficheros, im\xE1genes y todos los recursos que necesite nuestra aplicaci\xF3n.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Cambia el directorio de trabajo a la carpeta personal del usuario</span>
pbuilder<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Configurar o modificar variables de entorno para el proceso con el m\xE9todo <code>environment()</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Retrieve and modify the process environment</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> environment <span class="token operator">=</span> pbuilder<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Get the PATH environment variable and add a new directory</span>
<span class="token class-name">String</span> systemPath <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;c:/users/public&quot;</span><span class="token punctuation">;</span>
environment<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> systemPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Add a new environment variable and use it as a part of the command</span>
environment<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;GREETING&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hola Mundo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
processBuilder<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;echo $GREETING&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Indicamos el directorio donde se encuentra el ejecutable</span>
<span class="token class-name">File</span> directorio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span> <span class="token punctuation">(</span><span class="token string">&quot;bin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pb<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span>directorio<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mostramos la informaci\xF3n de las variables de entorno</span>
<span class="token class-name">Map</span> variablesEntorno <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>variablesEntorno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mostramos el nombre del proceso y sus argumentos</span>
<span class="token class-name">List</span> command <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Iterator</span> iter <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>::: info Variables de entorno vs Propiedades del sistema Con la clase Runtime accedemos a las variables del sistema mientras que con ProcessBuilder lo hacemos a las propiedades del sistema, que son diferentes. :::</p></li><li><p>Redireccionar la entrada y salida est\xE1ndar</p></li><li><p>Heredar la E/S est\xE1ndar del proceso padre usando el m\xE9todo ProcessBuilder.inheritIO()</p><p><em>Estas dos configuraciones se ver\xE1n en el siguiente apartado.</em></p></li></ul><p>::: question Actividad psp.activities.U2A2_DirectorioTrabajo Crea un nuevo proyecto Java (Ant &gt; Java Application) (configura como nombre del proyecto U2A2_DirectorioTrabajo y como clase principal psp.activities.U2A2_WorkingDirectory) Escribe un programa que ejecute el comando ls o dir. Modifica el valor de la propiedad user.dir. En la misma aplicaci\xF3n, cambiar el directorio de trabajo a la carpeta c:/temp o /tmp, dependiendo del sistema operativo.</p><p>Muestra el valor devuelto por el m\xE9todo directory()</p><ul><li>Despu\xE9s de crear la instancia de ProcessBuilder</li><li>Despu\xE9s de cambiar el valor de user.dir</li><li>Despu\xE9s de cambiar el directorio de trabajo al directorio temporal del sistema.</li></ul><p><em>En este momento tu programa todav\xEDa no mostrar\xE1 ning\xFAn listado.</em> :::</p><details class="custom-container details"><summary>Soluci\xF3n de U2A2_DirectorioTrabajo</summary><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">U2A2_WorkingDirectory</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// Prepare the command</span>
        <span class="token class-name">String</span> command<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;os.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;windows&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            command <span class="token operator">=</span> <span class="token string">&quot;cmd /c dir&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            command <span class="token operator">=</span> <span class="token string">&quot;sh -c ls&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Prepare the process and launch it</span>
        <span class="token class-name">ProcessBuilder</span> commander <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//1st - Default working directory</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Working directory: &quot;</span> <span class="token operator">+</span> commander<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir variable: &quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//2nd - Set the user.dir</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Working directory: &quot;</span> <span class="token operator">+</span> commander<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir variable: &quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 3rd - Change the working directory</span>
        commander<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Working directory: &quot;</span> <span class="token operator">+</span> commander<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir variable: &quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        commander<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><div class="pagebreak"></div><h2 id="_2-2-2-acceso-al-proceso-una-vez-en-ejecucion" tabindex="-1">2.2.2 Acceso al proceso una vez en ejecuci\xF3n</h2><p>LA clase <code>Process</code> es una clase abstracta definida en el paquete java.lang y contiene la informaci\xF3n del proceso en ejecuci\xF3n. Tras invocar al m\xE9todo <code>start</code> de ProcessBuilder, \xE9ste devuelve una referencia al proceso en forma de objeto Process.</p><p>Los m\xE9todos de la clase Process pueden ser usados para realizar operaciones de E/S desde el proceso, para comprobar su estado, su valor de retorno, para esperar a que termine de ejecutarse y para forzar la terminaci\xF3n del proceso. Sin embargo estos m\xE9todos no funcionan sobre procesos especiales del SO como pueden ser servicios, shell scripts, demonios, etc.</p>`,24),T={href:"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Process.html",target:"_blank",rel:"noopener noreferrer"},J=s("Especificaci\xF3n java.lang.Process"),N=c(`<div class="custom-container warning"><p class="custom-container-title">Entrada / Salida desde el proceso hijo</p><p>Curiosamente <strong>los procesos lanzados con el m\xE9todo start() no tienen una consola asignada.</strong>. Por contra, estos procesos redireccionan los streams de E/S est\xE1ndar (stdin, stdout, stderr) al proceso padre. Si se necesita, se puede acceder a ellos a trav\xE9s de los streams obtenidos con los m\xE9todos definidos en la clase Process como getInputStream(), getOutputStream() y getErrorSteam(). Esta es la forma de enviar y recibir informaci\xF3n desde los subprocesos.</p></div><p>Some of the common methods defined in this class are:</p><table><thead><tr><th style="text-align:left;">M\xE9todo</th><th style="text-align:left;">Descripci\xF3n</th></tr></thead><tbody><tr><td style="text-align:left;">int exitValue()</td><td style="text-align:left;">C\xF3digo de finalizaci\xF3n devuelto por el proceso hijo (ver Info m\xE1s abajo)</td></tr><tr><td style="text-align:left;">Boolean isAlive()</td><td style="text-align:left;">Comprueba si el proceso todav\xEDa est\xE1 en ejecuci\xF3n</td></tr><tr><td style="text-align:left;">int waitFor()</td><td style="text-align:left;">hace que el proceso padre se quede esperando a que el proceso hijo termine. El entrono que devuelve es el c\xF3digo de finalizaci\xF3n del proceso hijo</td></tr><tr><td style="text-align:left;">Boolean waitFor(long timeOut, TimeUnit unit)</td><td style="text-align:left;">El funcionamiento es el mismo que en el caos anterior s\xF3lo que en esta ocasi\xF3n podemos especificar cu\xE1nto tiempo queremos esperar a que el proceso hijo termine. El m\xE9todo devuelve true si el proceso termina antes de que pase el tiempo indicado y false si ha pasado el tiempo y el proceso no ha terminado.</td></tr><tr><td style="text-align:left;">void destroy()</td><td style="text-align:left;">Estos dos m\xE9todos se utilizan para matar al proceso. El segundo lo hace de forma forzosa.</td></tr><tr><td style="text-align:left;">Process destroyForcibly()</td><td style="text-align:left;"></td></tr></tbody></table><p>Veamos un sencillo ejemplo. Una vez lanzado el programa espera durante 10 segundos y a continuaci\xF3n mata el proceso.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProcessDemo</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

      <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\Program Files\\Mozilla Firefox&gt;firefox.exe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Effectively launch the process</span>
      <span class="token class-name">Process</span> p <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Check is process is alive or not</span>
      <span class="token keyword">boolean</span> alive <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Wait for the process to end for 10 seconds.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Process has finished&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Timeout. Process hasn&#39;t finished&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Force process termination.</span>
      p<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Check again if process remains alive</span>
      <span class="token keyword">boolean</span> alive <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Get the process exit value</span>
      <span class="token keyword">int</span> status <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">exitValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>::: info C\xF3digos de terminaci\xF3n Un c\xF3digo de salida (exit code o a veces tambi\xE9n return code) es el valor que un proceso le devuelve a su proceso padre para indicarle c\xF3mo ha acabado. Si un proceso acaba con un valor de finalizaci\xF3n 0 es que todo ha ido bien, cualquier otro valor entre 1 to 255 indica alguna causa de error. :::</p><p>::: question Actividad psp.activities.U2A3_ExitValue Crea un nuevo proyecto Java (Ant &gt; Java Application) (configura como nombre del proyecto U2A3_ExitValue y como clase principal psp.activities.U2A3_ExitValue). Prepara un programa que ejecute varios comandos (notepad, calc, comandos shell) uno detr\xE1s de otro, de forma secuencial y haz que tu programa obtenga el c\xF3digo de finalizaci\xF3n de cada uno de ellos. Para cada programa imprime el nombre y su c\xF3digo de finalizaci\xF3n.</p><p>Prueba a poner aplicaciones que no existan o comandos con par\xE1metros incorrectos.</p><p>\xBFQu\xE9 hace Netbeans si pones System.exit(10) para acabar tu programa?. F\xEDjate en la consola. \xBFQu\xE9 hace Netbeans si pones System.exit(0) para acabar tu programa.? Cu\xE1l es entonces el valor por defecto? :::</p><details class="custom-container details"><summary>Soluci\xF3n de U2A3_ExitValue</summary><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">U2A3_ExitValue</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token comment">// C\xF3digo para pedir un programa/comando a ejecutar</span>
            <span class="token class-name">Scanner</span> teclado <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Introduce el programa / comando que quieres ejecutar (intro para acabar): &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> comando <span class="token operator">=</span> teclado<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span>comando<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// Preparamos el entrono de ejecuci\xF3n del proceso</span>
                <span class="token comment">// Como no sabemos el contenido del comando, forzamos su conversi\xF3n</span>
                <span class="token comment">// a una lista para que no haya problemas con su ejecuci\xF3n</span>
                <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>comando<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Lanzamos el proceso hijo</span>
                <span class="token class-name">Process</span> p <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          

                <span class="token comment">// Esperamos a que acabe para recoger el valor de salida</span>
                <span class="token keyword">int</span> exitValue <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>exitValue <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;El comando &quot;</span> <span class="token operator">+</span> pb<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ha finalizado bien&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;El comando &quot;</span> <span class="token operator">+</span> pb<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ha finalizado con errores. C\xF3digo (&quot;</span> <span class="token operator">+</span> exitValue <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getLocalizedMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>                       
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><div class="custom-container danger"><p class="custom-container-title">Gesti\xF3n de excepciones</p><p>La llamada al m\xE9todo <strong>waitFor</strong> hace que el proceso padre se bloquee hasta que el proceso hijo termina o bien hasta que el bloqueo es interrumpido por alguna se\xF1as del sistema (Excepci\xF3n) que recibe el proceso padre.</p><p>Es mejor gestionar las excepciones lo m\xE1s cerca posible del origen en vez de pasarlas a niveles superiores.</p></div><h3 id="lanzar-una-clase-java-como-proceso-desde-otra-clase-java-en-el-mismo-proyecto" tabindex="-1">Lanzar una clase Java como proceso desde otra clase java en el mismo proyecto</h3><p>Para las actividades os pedir\xE9 que program\xE9is tanto el proceso padre como el proceso hijo. Para hacer eso, una de las clases tendr\xE1 que lanzar a la otra.</p><p>Para hacer esto, ambas clases deben tener un m\xE9todo main. As\xED que en las propiedades del proyecto Netbeans deberemos seleccionar cu\xE1l de las clases se ejecutar\xE1 primero, normalmente la clase <code>Lanzador o Launcher</code> (proceso padre).</p><p><img src="`+u+'" alt="Seleccionar clase principal"></p><p>BeforeAntes de que una clase pueda lanzar a otra, al menos la segunda (proceso hijo) debe estar compilada, es decir, el archivo .class debe haberse creado dentro del directorio build/classes.</p><p><img src="'+r+`" alt="Seleccionar directorio de trabajo "></p><p>Entonces y s\xF3lo entonces, previa configuraci\xF3n de los par\xE1metros de ejecuci\xF3n del proceso pueden establecerse, como en el ejemplo, para ejecutar una clase desde otra.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Prepare the environment and the command</span>
<span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;psp.u2.actividad10.Sumador&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pb<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;build/classes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Process</span> p <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>::: question Actividad psp.activities.U2A4_Lanzador Crea un nuevo proyecto Java (Ant &gt; Java Application) (configura como nombre del proyecto U2A3_Lanzador y como clase principal psp.activities.U2A4_Lanzador).</p><p>Ahora, en el mismo proyecto y dentro del mismo paquete crea otra clase, Mandado con un m\xE9todo main que recibir\xE1 el nombre del programa que debe ejecutar como par\xE1metro del m\xE9todo main(args). Haz que esta aplicaci\xF3n cree un nuevo proceso para ejecutar el programa recibido como par\xE1metro.</p><p>La clase terminar\xE1 devolviendo como c\xF3digo de finalizaci\xF3n el que el programa lanzado le haya devuelto a ella.</p><blockquote><p>M\xE9todo System.exit()</p><ul><li>Cero. El c\xF3digo cero debe devolverse cuando la ejecuci\xF3n del proceso haya ido bien, esto es, que ha terminado su ejecuci\xF3n sin problemas.</li><li>Distinto de cero. AUn c\xF3digo distinto de cero indica una terminaci\xF3n con errores. Java nos permite usar c\xF3digos diferentes para los diferentes tipos de error.</li></ul></blockquote><p>Por \xFAltimo, podemos hacer que U2A4_Lanzador pregunte al usuario qu\xE9 aplicaci\xF3n quiere ejecutar y pas\xE1rsela a la clase U2A4_Mandado.</p><p>En Lanzador recoge el c\xF3digo de finalizaci\xF3n de Mandado y muestra un mensaje indicando si el proceso termin\xF3 bien o con errores. :::</p><details class="custom-container details"><summary>Soluci\xF3n de U2A4_Lanzador</summary><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">U2A4_Launcher</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// C\xF3digo para pedir un programa/comando a ejecutar</span>
        <span class="token class-name">Scanner</span> teclado <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Introduce el programa / comando que quieres ejecutar: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> comando <span class="token operator">=</span> teclado<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// Preparamos el entrono de ejecuci\xF3n del proceso</span>
            <span class="token comment">// Como no sabemos el contenido del comando, forzamos su conversi\xF3n</span>
            <span class="token comment">// a una lista para que no haya problemas con su ejecuci\xF3n</span>
            comando <span class="token operator">=</span> <span class="token string">&quot;java psp.activities.U2A4_Commander &quot;</span> <span class="token operator">+</span> comando<span class="token punctuation">;</span>
            <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>comando<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pb<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;build/classes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Lanzamos el proceso hijo</span>
            <span class="token class-name">Process</span> p <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          

            <span class="token comment">// Esperamos a que acabe para recoger el valor de salida</span>
            <span class="token keyword">int</span> exitValue <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>exitValue <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;El comando &quot;</span> <span class="token operator">+</span> pb<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ha finalizado bien&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;El comando &quot;</span> <span class="token operator">+</span> pb<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ha finalizado con errores. C\xF3digo (&quot;</span> <span class="token operator">+</span> exitValue <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getLocalizedMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>                       
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">U2A4_Commander</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>       
        <span class="token comment">// Lectura de informaci\xF3n desde los par\xE1metros de entrada </span>
        <span class="token comment">// Se supone que recibimos: args[0] args[1] args[2] ..... args[args.length-1 --&gt; comando a ejecutar</span>
        <span class="token class-name">String</span> comando <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            comando <span class="token operator">+=</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        comando<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
        <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>comando<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            

        <span class="token comment">// Lanzamos el proceso hijo</span>
        <span class="token class-name">Process</span> p <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          

        <span class="token comment">// Esperamos a que acabe para recoger el valor de salida</span>
        <span class="token keyword">int</span> exitValue <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>exitValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><div class="custom-container warning"><p class="custom-container-title">Programaci\xF3n de clases &quot;hijas&quot;</p><p>Debemos tener en cuenta que una clase se puede ejecutar de forma independiente o puede ser llamada desde otro proceso.</p><p>Por eso, el c\xF3digo de las clases, hijas o padres, se hace sin tener en cuenta c\xF3mo van a ser llamadas. Debe ser <strong>independiente</strong> tal y como lo son unos procesos de otros.</p></div>`,27);function W(G,R){const l=p("DownloadPDF-component"),i=p("DocumentCover-component"),e=p("router-link"),o=p("ExternalLinkIcon");return k(),m("div",null,[a(l),a(i,{titulo:"2.2 Gesti\xF3n de procesos en Java - ProcessBuilder y Process"}),b,n("nav",g,[n("ul",null,[n("li",null,[a(e,{to:"#_2-2-1-preparacion-y-configuracion-de-un-proceso"},{default:t(()=>[f]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#modificar-el-comando-en-tiempo-de-ejecucion"},{default:t(()=>[y]),_:1})]),n("li",null,[a(e,{to:"#configuraciones-adicionales-de-un-proceso"},{default:t(()=>[h]),_:1})])])]),n("li",null,[a(e,{to:"#_2-2-2-acceso-al-proceso-una-vez-en-ejecucion"},{default:t(()=>[q]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#lanzar-una-clase-java-como-proceso-desde-otra-clase-java-en-el-mismo-proyecto"},{default:t(()=>[w]),_:1})])])])])]),j,S,n("ul",null,[n("li",null,[_,P,n("a",x,[E,a(o)])]),n("li",null,[A,B,n("a",z,[C,a(o)])])]),L,n("div",U,[F,D,V,n("p",null,[n("a",I,[M,a(o)])])]),O,n("blockquote",null,[n("p",null,[n("a",T,[J,a(o)])])]),N])}const Y=d(v,[["render",W],["__file","processbuilder.html.vue"]]);export{Y as default};
